<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Strings are for text</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <link rel="stylesheet" href="style.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">Strings are for text</h1>
</header>
<p><a href="boolean_blindness.html">Boolean blind</a> code collapses information that it needs down to a <code>bool</code>, typically requiring it to do extra work to get that information again in the future. By analogy, we could say that code suffers from “text blindness” when it hides hard-won knowledge in an obscure and difficult to use form—a string.</p>
<p>The basic rule is that strings are best for representing two things in computer programs:</p>
<ol type="1">
<li>Pure, human-oriented text.</li>
<li>Text-based protocols and data formats for external communication and persistent storage.</li>
</ol>
<p>What programs should not do: Hide internal, structured information inside a string.</p>
<p>In case 1, unless your program is doing <a href="https://en.wikipedia.org/wiki/Natural_language_processing">NLP</a>, it isn’t interested in any structure within the text beyond the (superficially) easy to discover structure of customary orthography (<em>e.g.,</em> words, sentences, paragraphs). If the text might sometimes contain some kind of machine-oriented structure (like HTML or YAML), that’s the humans’ business, and your program doesn’t intend to know or care.</p>
<p>In case 2, structured information needs to be exchanged with other programs.<a name="return_from_talking_to_self"><a href="#talking_to_self">¹</a></a> For example, the specification of your library or program may require it to speak CSV, HTTP<a name="return_from_http_text"><a href="#http_text">²</a></a>, JSON, MIME, SMTP, XML, or any of thousands of other textual protocols or data formats. In that case, strings are appropriate <em>at the edges of your program</em>, but not internally. When your program gets text from outside that contains structured information that it need to understand, then nearly always the <em>very first thing it should do</em> is validate and parse the text into a structured representation—structs, enums, numbers, vectors, sets, and maps—with strings confined to the leaves once no finer structure is relevant. And when your program needs to unparse structured information into a textual format for some other program to parse, then nearly always that’s the <em>very last thing it should do</em> before actually writing out or transmitting the encoded information. Usually it shouldn’t collect its output into a string, since the <code>Write</code> trait and <code>std::fmt::Formatter</code> type provide easy ways to specify serialization as a sequence of writes that may be executed with a variety of output devices, buffered or unbuffered, or accumulated into a string.</p>
<p>Here’s what the great 20th century computer scientist Alan Perlis had to say about strings:</p>
<blockquote>
<p>The string is a stark data structure and everywhere it is passed there is much duplication of process. It is a perfect vehicle for hiding information.</p>
</blockquote>
<p>Why would he say this? Consider a function like this:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="kw">pub</span> <span class="kw">fn</span> is_even(z<span class="op">:</span> <span class="dt">i32</span>) <span class="op">-&gt;</span> <span class="op">&amp;</span><span class="ot">&#39;static</span> <span class="dt">str</span> <span class="op">{</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a>    <span class="kw">if</span> z <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">0</span> <span class="op">{</span> <span class="st">&quot;true&quot;</span> <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span> <span class="st">&quot;false&quot;</span> <span class="op">}</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a><span class="op">}</span></span></code></pre></div>
<p>The result of that function is actually reasonably easy to use, provided that the limited number of possible results is documented. But you probably wouldn’t write it that way, right? Why not?</p>
<p>What about this function?</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a><span class="kw">pub</span> <span class="kw">fn</span> div_mod(a<span class="op">:</span> <span class="dt">i32</span><span class="op">,</span> b<span class="op">:</span> <span class="dt">i32</span>) <span class="op">-&gt;</span> <span class="dt">String</span> <span class="op">{</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a>    <span class="pp">format!</span>(<span class="st">&quot;{} {}&quot;</span><span class="op">,</span> a <span class="op">/</span> b<span class="op">,</span> a <span class="op">%</span> b)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a><span class="op">}</span></span></code></pre></div>
<p>Or what about this function?</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a><span class="kw">pub</span> <span class="kw">fn</span> div_mod_safe(a<span class="op">:</span> <span class="dt">i32</span><span class="op">,</span> b<span class="op">:</span> <span class="dt">i32</span>) <span class="op">-&gt;</span> <span class="dt">String</span> <span class="op">{</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a>    <span class="kw">if</span> b <span class="op">==</span> <span class="dv">0</span> <span class="op">{</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true"></a>        <span class="pp">format!</span>(<span class="st">&quot;Would divide {} by zero&quot;</span><span class="op">,</span> a)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true"></a>    <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> a <span class="op">==</span> <span class="dt">i32</span><span class="pp">::</span>min_value() <span class="op">&amp;&amp;</span> b <span class="op">==</span> <span class="op">-</span><span class="dv">1</span> <span class="op">{</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true"></a>        <span class="st">&quot;Division would overflow&quot;</span><span class="op">.</span>to_owned()</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true"></a>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true"></a>        <span class="pp">format!</span>(<span class="st">&quot;{} {}&quot;</span><span class="op">,</span> a <span class="op">/</span> b<span class="op">,</span> a <span class="op">%</span> b)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true"></a><span class="op">}</span></span></code></pre></div>
<p>Consider what a client would need to do in order to:</p>
<ol type="1">
<li>distinguish success from failure,</li>
<li>print the quotient or the remainder without the other,</li>
<li>use the quotient and/or the remainder in a subsequent arithmetic operation,</li>
<li>react differently to the two possible failures, or</li>
<li>show the failure messages in the user’s preferred language.</li>
</ol>
<p>At this point, I hope you are wanting <code>div_mod</code> and <code>div_mod_safe</code> to return the two numbers <em>as numbers</em>, in a pair. In some languages you’d return a third component as well to indicate errors, but Rust’s <code>enum</code>s represent the possible situations more tightly:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a><span class="kw">pub</span> <span class="kw">fn</span> div_mod_safe(a<span class="op">:</span> <span class="dt">i32</span><span class="op">,</span> b<span class="op">:</span> <span class="dt">i32</span>) <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span>(<span class="dt">i32</span><span class="op">,</span> <span class="dt">i32</span>)<span class="op">,</span> <span class="dt">String</span><span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true"></a>    <span class="kw">if</span> b <span class="op">==</span> <span class="dv">0</span> <span class="op">{</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true"></a>        <span class="cn">Err</span>(<span class="pp">format!</span>(<span class="st">&quot;Would divide {} by zero&quot;</span><span class="op">,</span> a))</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true"></a>    <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> a <span class="op">==</span> <span class="dt">i32</span><span class="pp">::</span>min_value() <span class="op">&amp;&amp;</span> b <span class="op">==</span> <span class="op">-</span><span class="dv">1</span> <span class="op">{</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true"></a>        <span class="cn">Err</span>(<span class="st">&quot;Division would overflow&quot;</span><span class="op">.</span>to_owned())</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true"></a>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true"></a>        <span class="cn">Ok</span>((a <span class="op">/</span> b<span class="op">,</span> a <span class="op">%</span> b))</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true"></a><span class="op">}</span></span></code></pre></div>
<p>That solves scenarios 1–3, but for 4 and 5 we need to stop hiding the structure of the error in a string as well. Here’s the easiest way:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a><span class="kw">pub</span> <span class="kw">enum</span> DivModError <span class="op">{</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true"></a>    DivByZero(<span class="dt">i32</span>)<span class="op">,</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true"></a>    WouldOverflow<span class="op">,</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true"></a><span class="kw">pub</span> <span class="kw">fn</span> div_mod_safe(a<span class="op">:</span> <span class="dt">i32</span><span class="op">,</span> b<span class="op">:</span> <span class="dt">i32</span>) <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span>(<span class="dt">i32</span><span class="op">,</span> <span class="dt">i32</span>)<span class="op">,</span> DivModError<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true"></a>    <span class="kw">if</span> b <span class="op">==</span> <span class="dv">0</span> <span class="op">{</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true"></a>        <span class="cn">Err</span>(<span class="pp">DivModError::</span>DivByZero(a))</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true"></a>    <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> a <span class="op">==</span> <span class="dt">i32</span><span class="pp">::</span>min_value() <span class="op">&amp;&amp;</span> b <span class="op">==</span> <span class="op">-</span><span class="dv">1</span> <span class="op">{</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true"></a>        <span class="cn">Err</span>(<span class="pp">DivModError::</span>WouldOverflow)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true"></a>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true"></a>        <span class="cn">Ok</span>((a <span class="op">/</span> b<span class="op">,</span> a <span class="op">%</span> b))</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true"></a><span class="op">}</span></span></code></pre></div>
<p>Using <code>Result</code>s to distinguish success from failure, <code>Option</code>s to distinguish presence from absence, numeric types to represent numbers, tuples and <code>struct</code>s to keep related pieces of information grouped together but represented independently, and <code>enum</code>s to distinguish alternative states—and reserving strings for text and communication—will make your code easier to write, easier to read, and maybe more efficient.</p>
<p>For a more detailed discussion focusing on representing errors, see <a href="custom_error.md">here</a>.</p>
<p><a name="talking_to_self" href="#return_from_talking_to_self">1</a>: Include among this the special case of sending information to a future run of the same program, which won’t have the same objects at the same addresses and might even lay them out differently.</p>
<p><a name="http_text" href="#return_from_http_text">2</a>: HTTP transmissions are not purely text, but they start out with ASCII headers, wherein negotiation to use another encoding in the body can happen.</p>
<hr />
<p><a href="index.html">Contents</a></p>
</body>
</html>
